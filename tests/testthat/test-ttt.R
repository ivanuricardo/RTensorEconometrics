test_that("n_mode_product", {
  library(rTensor)
  x <- as.tensor(array(1:24, dim = c(3,4,2)))
  y <- as.tensor(array(1:24, dim = c(2,3,4)))
  
  result <- ttt(x, y, alongA = 3, alongB = 1)
  expected <- as.tensor(array(c(27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60,
                              55, 62, 69, 76, 83, 90, 97, 104, 111, 118, 125,
                              132, 83, 94, 105, 116, 127, 138, 149, 160, 171,
                              182, 193, 204, 111, 126, 141, 156, 171, 186, 201,
                              216, 231, 246, 261, 276, 139, 158, 177, 196, 215,
                              234, 253, 272, 291, 310, 329, 348, 167, 190, 213,
                              236, 259, 282, 305, 328, 351, 374, 397, 420, 195,
                              222, 249, 276, 303, 330, 357, 384, 411, 438, 465,
                              492, 223, 254, 285, 316, 347, 378, 409, 440, 471, 
                              502, 533, 564, 251, 286, 321, 356, 391, 426, 461,
                              496, 531, 566, 601, 636, 279, 318, 357, 396, 435,
                              474, 513, 552, 591, 630, 669, 708, 307, 350, 393,
                              436, 479, 522, 565, 608, 651, 694, 737, 780, 335,
                              382, 429, 476, 523, 570, 617, 664, 711, 758, 805,
                              852), dim = c(3, 4, 3, 4)))
  
  expect_equal(result@data, expected@data)
  expect_equal(result@modes, expected@modes)
})

test_that("contracted_product", {
  library(rTensor)
  x <- as.tensor(array(1:36, dim = c(3,2,3,2)))
  y <- as.tensor(array(1:120, dim = c(3,2,4,5)))
  
  result <- ttt(x, y, alongA = c(3,4), alongB = c(1,2))
  expected <- as.tensor(array(c(441, 462, 483, 504, 525, 546, 1017,
                                1074, 1131, 1188, 1245, 1302, 1593,
                                1686, 1779, 1872, 1965, 2058, 2169,
                                2298, 2427, 2556, 2685, 2814, 2745,
                                2910, 3075, 3240, 3405, 3570, 3321,
                                3522, 3723, 3924, 4125, 4326, 3897,
                                4134, 4371, 4608, 4845, 5082, 4473,
                                4746, 5019, 5292, 5565, 5838, 5049,
                                5358, 5667, 5976, 6285, 6594, 5625,
                                5970, 6315, 6660, 7005, 7350, 6201,
                                6582, 6963, 7344, 7725, 8106, 6777,
                                7194, 7611, 8028, 8445, 8862, 7353,
                                7806, 8259, 8712, 9165, 9618, 7929,
                                8418, 8907, 9396, 9885, 10374, 8505,
                                9030, 9555, 10080, 10605, 11130, 9081,
                                9642, 10203, 10764, 11325, 11886, 9657,
                                10254, 10851, 11448, 12045, 12642, 10233,
                                10866, 11499, 12132, 12765, 13398, 10809,
                                11478, 12147, 12816, 13485, 14154, 11385,
                                12090, 12795, 13500, 14205, 14910),
                              dim = c(3,2,4,5)))
  expect_equal(result@data, expected@data)
  expect_equal(result@modes, expected@modes)
})

test_that("rearranged_product", {
  library(rTensor)
  x <- as.tensor(array(1:36, dim = c(3,2,3,2)))
  y <- as.tensor(array((-18):17, dim = c(3,2,3,2)))
  
  result <- ttt(x, y, alongA = c(1,2), alongB = c(1,2))
  expected <- as.tensor(array(c(-308, -866, -1424, -1982, -2540,
                                -3098, -182, -524, -866, -1208,
                                -1550, -1892, -56, -182, -308,
                                -434, -560, -686, 70, 160, 250,
                                340, 430, 520, 196, 502, 808,
                                1114, 1420, 1726, 322, 844, 1366,
                                1888, 2410, 2932), dim = c(3,2,3,2)))
  
  expect_equal(result@data, expected@data)
  expect_equal(result@modes, expected@modes)
})

test_that("equal_dimensions", {
  library(rTensor)
  x <- rand_tensor(modes = c(3, 3, 3, 3))
  y <- rand_tensor(modes = c(3, 3, 3, 3))
  
  result <- ttt(x, y, alongA = c(3:4), alongB = c(1:2))
  
  expect_equal(result@modes, x@modes)
})